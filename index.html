<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Jimmy's Blog">
<meta property="og:url" content="http://keshuangjie.github.io/index.html">
<meta property="og:site_name" content="Jimmy's Blog">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Jimmy's Blog">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"hide"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Jimmy's Blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?9e9d54ebc938fae652c6ea1455a3c2c5";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Jimmy's Blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/09/26/Android-Handler混淆概念解析/" itemprop="url">
                  Android Handler混淆概念解析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-09-26T09:57:08+08:00" content="2016-09-26">
              2016-09-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/09/26/Android-Handler混淆概念解析/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/09/26/Android-Handler混淆概念解析/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>在Android开发过程中，使用Handler实现子线程更新ui的操作非常多。本文将以问题的形式一步步来解锁正确使用Handler的姿势。</p>
<p><strong>Handler消息机制的实现原理是怎样的？</strong></p>
<p>Handler消息机制在Android系统起着非常重要的作用，非UI线程与UI线程通信都是通过Handler来完成，先来看下Handler消息机制的实现原理：<br><img src="/images/handler-theory.png" alt=""><br>实现并不复杂，总共涉及4个类：</p>
<ul>
<li>Message：消息体，用于装载需要发送的消息对象。</li>
<li>Looper：是每个线程中的MessageQueue的管家，负责接收和分发Message或Runnable的工作。调用Looper.loop()方法，就是一个死循环，不断地从MessageQueue中取消息：如果有消息，就取出，并调用Handler的handlerMessage()方法；如果没有消息阻塞。</li>
<li>MessageQueue：用于存放Message或Runnable对象的消息队列。它由对应的Looper对象创建，并由Looper对象管理。每个线程中都只会有一个MessageQueue对象。</li>
<li>Handler：它直接继承自Object。作用是发送Message加入到消息队列中等待执行，并处理消息的回调。发送消息一般使用Handler的sendMessage()方法，而发出去的消息最执行会调用Handler的handlerMessage()方法中。</li>
</ul>
<p><strong>handler.obtain()和new Message()的区别？</strong></p>
<p>handler.obtain实际调用的是Message.obtain(handler),实现过程是在Message.obtain():</p>
<pre><code>public static Message obtain() {
    synchronized (sPoolSync) {
        if (sPool != null) {
            Message m = sPool;
            sPool = m.next;
            m.next = null;
            m.flags = 0; // clear in-use flag
            sPoolSize--;
            return m;
        }
    }
    return new Message();
}
</code></pre><p>看sPool命名可以知道是一个缓存池，但是它并不是一个集合，而是一个static Message变量，那么它是怎么实现缓存的呢？来看下Message回收的方法recycleUnchecked：</p>
<pre><code>void recycleUnchecked() {
    // Mark the message as in use while it remains in the recycled object pool.
    // Clear out all other details.
    flags = FLAG_IN_USE;
    what = 0;
    arg1 = 0;
    arg2 = 0;
    obj = null;
    replyTo = null;
    sendingUid = -1;
    when = 0;
    target = null;
    callback = null;
    data = null;

    synchronized (sPoolSync) {
        if (sPoolSize &lt; MAX_POOL_SIZE) {
            next = sPool;
            sPool = this;
            sPoolSize++;
        }
    }
}
</code></pre><p>Message消息执行完后都会调用recycleUnchecked进行回收，可以到Message对象并没有销毁，而是将属性都恢复初始值，将当前Message的next属性指向sPool，静态Message属性sPool指向当前Message。看到这里就很明显了，Message本身就实现了链表式的集合，MAX_POOL_SIZE是链表的长度。<br><strong>总结：</strong>Message中有一个缓存池，会存储执行完成的Message对象。Handler.obtain()方法会先去从缓存中取，如果缓存中没有才去new，缓存中最多保存50个Message对象。</p>
<p><strong>Handler中sendMessage()和dispatchMessage()的区别？</strong></p>
<p>Handler中有多个类似sendMessage的方法，分别用于发送空消息、定时消息、延迟消息、优先消息，最终都会调用Handler中MessageQueue的enqueueMessage()，enqueueMessage中的逻辑是根据消息的最终执行时间来将消息插入到消息队列中等待执行。来看下dispatchMessage方法：</p>
<pre><code>/**
 * Handle system messages here.
 */
public void dispatchMessage(Message msg) {
    if (msg.callback != null) {
        handleCallback(msg);
    } else {
        if (mCallback != null) {
            if (mCallback.handleMessage(msg)) {
                return;
            }
        }
        handleMessage(msg);
    }
}
</code></pre><p>可以看到Message消息直接回调执行了，并没有加入到消息队列。在开发过程中，好多同学根据这两个方法的命名误认为都是发送消息都会加入消息队列中执行，而并没有真正的理解这两个方法的实现。<br><strong>总结：</strong></p>
<ul>
<li>sendMessage()方法是将Message加入消息队列等待执行，回调总是在handler所在线程处理。</li>
<li>dispatchMessage()方法是直接调用回调执行，是在当前线程。</li>
</ul>
<p><strong>Handler消息的回调是不是总在handlerMessage()中处理？</strong></p>
<p>Looper中loop方法通过死循环的方式不断的从消息队列里面拿取消息进行回调处理，调用的是msg.target.dispatchMessage(msg)，msg的target属性是Handler对象，所以最终处理是在Handler的dispatchMessage中，上面有代码可以看到回调的顺序：</p>
<ol>
<li>当Message的回调方法不为空时，则回调方法msg.callback.run()，其中callBack数据类型为Runnable,否则进入步骤2；</li>
<li>当Handler的mCallback成员变量不为空时，则回调方法mCallback.handleMessage(msg),并且mCallback.handleMessage返回false才会进入步骤3；</li>
<li>调用Handler自身的回调方法handleMessage()，该方法默认为空，Handler子类通过覆写该方法来完成具体的逻辑。</li>
</ol>
<p>看Android应用的启动过程，我们知道App的启动入口是ActivityThread的main方法：</p>
<pre><code>public static void main(String[] args) { 
      .... 
    // 创建Looper和MessageQueue对象，用于处理主线程的消息     Looper.prepareMainLooper(); 

    // 创建ActivityThread对象 
    ActivityThread thread = new ActivityThread(); 

    // 建立Binder通道 (创建新线程) 
    thread.attach(false); 
    //  消息循环运行 
    Looper.loop(); 
    throw new RuntimeException(&quot;Main thread loop unexpectedly exited&quot;);
}
</code></pre><p>main方法中调用Looper.prepareMainLooper()创建了主线程的looper，方法最后调用了Looper.loop()。从上面分析我们知道loop方法中实现了死循环，那么问题来了。</p>
<p><strong>主线程为什么不会因为死循环卡死？</strong></p>
<p>事实上，在进入死循环之前便创建了新Binder线程，在代码ActivityThread.main()中。thread.attach(false)会创建一个Binder线程（具体是指ApplicationThread，Binder的服务端，用于接收系统服务AMS发送来的事件），该Binder线程通过Handler将Message发送给主线程。</p>
<p>Activity的生命周期都是依靠主线程的Looper.loop，当收到不同Message时则采用相应措施。ActivityThread中有个内部类H继承于Handler，在H.handleMessage(msg)方法中，根据接收到不同的msg，执行相应的生命周期。比如收到msg=H.LAUNCH_ACTIVITY，则调用ActivityThread.handleLaunchActivity()方法，最终会通过反射机制，创建Activity实例，然后再执行Activity.onCreate()等方法；<br>再比如收到msg=H.PAUSE_ACTIVITY，则调用ActivityThread.handlePauseActivity()方法，最终会执行Activity.onPause()等方法。</p>
<p>主线程的消息又是哪来的呢，是App进程中的其他线程通过Handler发送给主线程，具体请看如下图：<br><img src="/images/handler-binder.jpg" alt=""></p>
<ul>
<li>system_server进程是系统进程，java framework框架的核心载体，里面运行了大量的系统服务，比如这里提供ApplicationThreadProxy（简称ATP），ActivityManagerService（简称AMS），这个两个服务都运行在system_server进程的不同线程中，由于ATP和AMS都是基于IBinder接口，都是binder线程，binder线程的创建与销毁都是由binder驱动来决定的。</li>
<li>App进程则是我们常说的应用程序，主线程主要负责Activity/Service等组件的生命周期以及UI相关操作都运行在这个线程； 另外，每个App进程中至少会有两个binder线程 ApplicationThread(简称AT)和ActivityManagerProxy（简称AMP），除了图中画的线程，其中还有很多线程，比如signal catcher线程等，这里就不一一列举。</li>
<li>Binder用于不同进程之间通信，由一个进程的Binder客户端向另一个进程的服务端发送事务，比如图中线程2向线程4发送事务；而handler用于同一个进程中不同线程的通信，比如图中线程4向主线程发送消息。</li>
</ul>
<p>结合图说说Activity生命周期，比如暂停Activity，流程如下：</p>
<ol>
<li>线程1的AMS中调用线程2的ATP；（由于同一个进程的线程间资源共享，可以相互直接调用，但需要注意多线程并发问题）</li>
<li>线程2通过binder传输到App进程的线程4；</li>
<li>线程4通过handler消息机制，将暂停Activity的消息发送给主线程；</li>
<li>主线程在looper.loop()中循环遍历消息，当收到暂停Activity的消息时，便将消息分发给ActivityThread.H.handleMessage()方法，再经过方法的调用，最后便会调用到Activity.onPause()，当onPause()处理完后，继续循环loop下去。</li>
</ol>
<p><strong>为什么要用死循环阻塞主线程？</strong></p>
<p>一个进程和线程在CPU看来无非是一段可执行的代码，代码执行完毕，线程的生命也就结束，但是对于一个App来说，我们肯定不能让它执行完一段程序然后自己就退出。为了能保证App的生命周期，Android采用了简单的做法就是通过死循环让代码一直执行下去。<br>可能有人又会问，主线程的死循环一直运行是不是特别消耗CPU资源呢？ 其实不会，这里就涉及到Linux pipe/epoll机制，大家有兴趣看下面参考文章自行详细了解。</p>
<p>参考：<br><a href="http://blog.csdn.net/luoshengyang/article/details/6685853" target="_blank" rel="external">Activity启动过程</a><br><a href="https://www.zhihu.com/question/34652589/answer/90344494" target="_blank" rel="external">主线程为什么不会因为loop卡死</a><br><a href="http://gityuan.com/2015/12/27/handler-message-native/" target="_blank" rel="external">handler消息机制-native层</a><br><a href="http://www.cnblogs.com/Anker/p/3265058.html" target="_blank" rel="external">select、poll、epoll之间的区别总结</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/19/Spark入门-环境搭建/" itemprop="url">
                  Spark入门-本地应用环境构建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-19T14:51:19+08:00" content="2016-08-19">
              2016-08-19
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Spark/" itemprop="url" rel="index">
                    <span itemprop="name">Spark</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/08/19/Spark入门-环境搭建/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/08/19/Spark入门-环境搭建/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文将介绍Spark的单机运行环境搭建，以及如何在IDE用scala语言开发Spark app，不涉及hdfs系统和hadoop。</p>
<h1 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h1><p>我使用的是MAC OS X EI Capitan 版本10.11.1，配置的开发环境如下：</p>
<ul>
<li>jdk1.8</li>
<li>scala-2.11.8</li>
<li>spark-1.6.2-bin-hadoop2.6</li>
</ul>
<h2 id="jdk安装"><a href="#jdk安装" class="headerlink" title="jdk安装"></a>jdk安装</h2><p><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="external">oracle网站</a>下载指定版本并安装，安装完成配置环境变量：<br>编辑~/.bash_profile文件，在最后加上java环境变量：</p>
<pre><code>export JAVA_HOME=/Users/jimmy/Documents/develop/java_1.8
export PATH=$JAVA_HOME/bin:$PATH
export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar
</code></pre><p>保存并跟新：</p>
<pre><code>$ source ~/.bash_profile
</code></pre><p>验证java是否安装成功:</p>
<pre><code>$ java -version
</code></pre><p>如果显示如下java版本信息则安装配置成功：</p>
<pre><code>java version &quot;1.8.0_91&quot;
Java(TM) SE Runtime Environment (build 1.8.0_91-b14)
Java HotSpot(TM) 64-Bit Server VM (build 25.91-b14, mixed mode)
</code></pre><h2 id="scala安装"><a href="#scala安装" class="headerlink" title="scala安装"></a>scala安装</h2><p><a href="http://www.scala-lang.org/download/" target="_blank" rel="external">scala官网</a>下载scala-2.11.8.tgz并解压到相应的目录。编辑~/.bash_profile文件，在最后加上scala环境变量:</p>
<pre><code>export SCALA_HOME=/Users/jimmy/Documents/develop/scala-2.11.8
export PATH=$PATH:$SCALA_HOME/bin
</code></pre><p>保存并更新：</p>
<pre><code>$ source ~/.bash_profile
</code></pre><p>验证scala安装、配置成功：</p>
<pre><code>$ scala -version
</code></pre><p>如果显示以下则安装、配置成功：</p>
<pre><code>Scala code runner version 2.11.8 -- Copyright 2002-2016, LAMP/EPFL
</code></pre><h2 id="spark安装"><a href="#spark安装" class="headerlink" title="spark安装"></a>spark安装</h2><p><a href="http://spark.apache.org/downloads.html" target="_blank" rel="external">spark官网</a>下载spark-1.6.2-bin-hadoop2.6.tgz并解压到相应目录。<br>cd到spark根目录，vim conf/spark-env.sh，添加如下配置：</p>
<pre><code>export SCALA_HOME=/Users/jimmy/Documents/develop/scala-2.11.8
export JAVA_HOME=/Users/jimmy/Documents/develop/java_1.8
export SPARK_MASTER_IP=localhost
export SPARK_WORKER_MEMORY=1024m
</code></pre><p>编辑~/.bash_profile文件，在最后加上spark环境变量：</p>
<pre><code>export SPARK_HOME=/Users/jimmy/Documents/develop/spark-1.6.2-bin-hadoop2.6
export PATH=$PATH:$SPARK_HOME/bin
</code></pre><p>验证spark安装、配置成功：</p>
<pre><code>$ spark-shell
</code></pre><p>最终显示scala&gt;说明安装成功：</p>
<pre><code>...
Welcome to
      ____              __
     / __/__  ___ _____/ /__
    _\ \/ _ \/ _ `/ __/  &apos;_/
   /___/ .__/\_,_/_/ /_/\_\   version 1.6.2
      /_/

Using Scala version 2.10.5 (Java HotSpot(TM) 64-Bit Server VM, Java 1.8.0_91)
...
16/08/22 20:34:12 WARN ObjectStore: Failed to get database default, returning NoSuchObjectException
SQL context available as sqlContext.

scala&gt; 
</code></pre><p>在scala&gt;后面可以直接运行scala语句，也可以使用spark环境和相关API，sc是已初始化的SparkContext对象。</p>
<h1 id="Spark项目构建"><a href="#Spark项目构建" class="headerlink" title="Spark项目构建"></a>Spark项目构建</h1><h3 id="SBT"><a href="#SBT" class="headerlink" title="SBT"></a>SBT</h3><p><a href="http://www.scala-sbt.org" target="_blank" rel="external">Sbt</a>是scala官网推荐的项目构建工具，类似与maven是java语言的主流构建工具，ant/gradle是Android主流的构建工具一样。<br>sbt安装很简单，直接下载解压，sbt的目录很简单，只包含两个文件:</p>
<pre><code>sbt
sbt-launch.jar
</code></pre><p>配置环境变量就可以直接在命令行里运行sbt，sbt首次运行会下载一些依赖包（由于网络环境问题，可能需要配置代理）。依赖包下载完成之后，就会进入到了stb的交互式操作控制台。</p>
<h3 id="Scala-ide"><a href="#Scala-ide" class="headerlink" title="Scala-ide"></a>Scala-ide</h3><p><a href="http://scala-ide.org/download/sdk.html" target="_blank" rel="external">Scala-ide</a>是scala官网推荐的集成了scala开发插件的eclipse。由于目前eclipse中并没有集成sbt的工具插件，所以不能在eclipse中直接new scala工程，而是需要通过sbt生成工程目录结构然后导入eclipse中。</p>
<h2 id="构建Eclipse工程"><a href="#构建Eclipse工程" class="headerlink" title="构建Eclipse工程"></a>构建Eclipse工程</h2><p>想要sbt生成eclipse工程需要先配置sbt-eclipse插件，可以使用全局和单个工程的配置方式。<br><strong>全局配置方式</strong><br>在sbt首次使用的时候会在~/用户目录下生成.sbt目录，.sbt目录下有一个0.13/plugins的空文件夹，在下面新建build.sbt文件，添加配置如下：</p>
<pre><code>addSbtPlugin(&quot;com.typesafe.sbteclipse&quot; % &quot;sbteclipse-plugin&quot; % &quot;2.4.0&quot;)
</code></pre><p><strong>单个工程配置</strong><br>单个工程配置是在每个工程的根目录*.sbt文件添加如上配置。</p>
<p>配置完sbt-eclipse配置，在工程目录下执行下面命令就可生成eclipse工程目录结构。</p>
<pre><code>$ sbt eclipse
</code></pre><p>将工程导入到eclipse，目录结构如下：<br><img src="/images/spark_project_dir.png" alt=""></p>
<h2 id="Eclipse中配置运行"><a href="#Eclipse中配置运行" class="headerlink" title="Eclipse中配置运行"></a>Eclipse中配置运行</h2><h3 id="scala程序运行"><a href="#scala程序运行" class="headerlink" title="scala程序运行"></a>scala程序运行</h3><p>运行scala程序非常简单，在src/main/scala下新建scala object “HelloScala.scala”</p>
<pre><code>object HelloScala {

  def main(args: Array[String]) {
    println(&quot;Hello, scala&quot;)
  }

}
</code></pre><p>右键–Run As–Scala Application，在控制台将打印”Hello, scala”。</p>
<h3 id="Spark程序运行"><a href="#Spark程序运行" class="headerlink" title="Spark程序运行"></a>Spark程序运行</h3><p>运行Spark程序需要依赖spark core库，手动添加如下（也可以通过sbt添加依赖库的方式自动添加，下面会介绍）：</p>
<ol>
<li>在工程目录下新建lib文件夹，copy $SPARK_HOME/lib/spark-assembly-1.6.2-hadoop2.6.0.jar到工程lib文件夹下</li>
<li>在eclipse中将jar添加到工程Build Path。</li>
</ol>
<p>新建scala objec HelloSpark.scala，羡慕程序中的”data/input”是文本文件，HelloSpark用于读取文件并计算包含”北京”字符串的行数：</p>
<pre><code>import org.apache.spark.SparkConf
import org.apache.spark.SparkContext

object HelloSpark {
  val logFile = &quot;data/input&quot;
  def main(args:Array[String]) {
    var cityName = &quot;&quot;
    if (args.length &lt; 1) cityName = &quot;北京&quot; else cityName = args(0)

    val conf = new SparkConf().setAppName(&quot;Spark Exercise: Spark Version Word Count Program&quot;);
    val sc = new SparkContext(conf);
    val textFile = sc.textFile(logFile);

    val city = (x: String) =&gt; x == &quot;北京&quot;;
    val beijingRdd  = textFile.filter(line =&gt; line.contains(cityName));
    println(&quot;contain beijing line count: &quot; + beijingRdd.count);
  }
}
</code></pre><p>由于没有配置master URL，直接运行HelloSpark会报错：</p>
<pre><code>Using Spark&apos;s default log4j profile: org/apache/spark/log4j-defaults.properties
16/08/23 11:44:57 INFO SparkContext: Running Spark version 1.6.2
16/08/23 11:44:57 WARN NativeCodeLoader: Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
16/08/23 11:44:57 ERROR SparkContext: Error initializing SparkContext.
org.apache.spark.SparkException: A master URL must be set in your configuration
    at org.apache.spark.SparkContext.&lt;init&gt;(SparkContext.scala:401)
    at HelloSpark$.main(HelloSpark.scala:11)
    at HelloSpark.main(HelloSpark.scala)
16/08/23 11:44:57 INFO SparkContext: Successfully stopped SparkContext
Exception in thread &quot;main&quot; org.apache.spark.SparkException: A master URL must be set in your configuration
    at org.apache.spark.SparkContext.&lt;init&gt;(SparkContext.scala:401)
at HelloSpark$.main(HelloSpark.scala:11)
at HelloSpark.main(HelloSpark.scala)
</code></pre><p>解决方案是在HelloSpark右键–Run As–Run Configurations…–Arguments–VM Arguments 框中配置：</p>
<pre><code>-Dspark.master=local
</code></pre><p>再点击运行可以在控制台上看到先初始化spark环境，然后进行计算打印计算结果：</p>
<pre><code>contain beijing line count: 2
</code></pre><h2 id="SBT编译打包"><a href="#SBT编译打包" class="headerlink" title="SBT编译打包"></a>SBT编译打包</h2><p>使用sbt对上述helloscala工程进行编译打包管理，在helloscala根目录下新建build.sbt文件，配置如下：</p>
<pre><code>name := &quot;helloscala&quot;  

version := &quot;1.0&quot;  

scalaVersion := &quot;2.10.5&quot;  

EclipseKeys.createSrc := EclipseCreateSrc.Default + EclipseCreateSrc.Resource  

libraryDependencies += &quot;org.apache.spark&quot; %% &quot;spark-core&quot; % &quot;1.6.2&quot;
</code></pre><p>注意：</p>
<ul>
<li>每行配置需要空一行</li>
<li>每次当build.sbt中相关配置变化后，都需要执行sbt eclipse命令来更新使其生效   </li>
</ul>
<p>libraryDependencies是添加项目依赖库，helloscala工程需要依赖spark环境。运行sbt相关命令时会先下载依赖库。<br>EclipseKeys.createSrc如果配置了，执行sbt eclipse命令时会生成Source Folder目录src/main/resources。</p>
<p>编译</p>
<pre><code>$ sbt compile
</code></pre><p>打包，打包完成会在targe/scala-2.10/下生成helloscala_2.10-1.0.jar。</p>
<pre><code>$ sbt package
</code></pre><h2 id="Spark-submit"><a href="#Spark-submit" class="headerlink" title="Spark-submit"></a>Spark-submit</h2><p>sbt打包的jar可以使用spark-submit命令提交到集群（此文中是本地集群）中进行计算，命令如下：</p>
<pre><code>spark-submit  --class  HelloSpark target/scala-2.10/helloscala_2.10-1.0.jar 
</code></pre><p>如果用HelloSpark统计包含”上海”的行数，需要传入参数：</p>
<pre><code>spark-submit  --class  HelloSpark target/scala-2.10/helloscala_2.10-1.0.jar &quot;上海&quot;
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/06/11/Data-Binding-on-Android/" itemprop="url">
                  Data Binding on Android
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-06-11T15:39:08+08:00" content="2016-06-11">
              2016-06-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/06/11/Data-Binding-on-Android/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/06/11/Data-Binding-on-Android/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Data Binbing框架是在2015年Google I/O大会上最早提出来的，一直在Android开发者中热议，但是很少有真正在项目中用到。本文简单介绍Data Binding框架的简单用法以及其特点。</p>
<h1 id="Build-Environment"><a href="#Build-Environment" class="headerlink" title="Build Environment"></a>Build Environment</h1><p>Android官网已经提供了支持Data Binding的support library，支持Android 2.1(API level 7+)以上版本。与常规Android工程配置相比，Data Binding支持需要配置如下编译环境：</p>
<ol>
<li>Android Studio 1.3以上才支持Android数据绑定</li>
<li>在Android SDK manager中下载最新的Android Support Library</li>
<li>在app工程build.gradle中配置dataBinding支持开关</li>
<li>在build.gradle添加dataBinding依赖库</li>
</ol>
<p>build.gradle配置如下：</p>
<pre><code>android {
    ....
    // dataBindng开关
    dataBinding {
        enabled = true
    }
}

dependencies {
    ....
    // 添加dataBinding支持依赖库
    compile &apos;com.android.support:appcompat-v7:23.3.0&apos;
}
</code></pre><h1 id="Hello-DataBinding"><a href="#Hello-DataBinding" class="headerlink" title="Hello DataBinding"></a>Hello DataBinding</h1><h2 id="DataBinding-Layout"><a href="#DataBinding-Layout" class="headerlink" title="DataBinding Layout"></a>DataBinding Layout</h2><p>DataBinding layout文件与普通layout有所不同，它的布局根节点是layout，下面是数据节点data，跟data同一层级是正常的layout布局文件。main_activity.xml代码如下：</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;
&lt;layout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;
    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;
    &lt;data&gt;
        &lt;variable name=&quot;user&quot; type=&quot;com.jimmy.demo.databinding.simple.model.User&quot;/&gt;
    &lt;/data&gt;

    &lt;RelativeLayout
            android:layout_width=&quot;match_parent&quot;
            android:layout_height=&quot;match_parent&quot;
            android:paddingLeft=&quot;@dimen/activity_horizontal_margin&quot;
            android:paddingRight=&quot;@dimen/activity_horizontal_margin&quot;
            android:paddingTop=&quot;@dimen/activity_vertical_margin&quot;
            android:paddingBottom=&quot;@dimen/activity_vertical_margin&quot;
            tools:context=&quot;com.jimmy.demo.databinding.simple.MainActivity&quot;&gt;

        &lt;TextView
                android:id=&quot;@+id/tv_name&quot;
                android:text=&quot;@{user.name}&quot;
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot;/&gt;

        &lt;TextView
                android:id=&quot;@+id/tv_age&quot;
                android:text=&quot;@{String.valueOf(user.age)}&quot;
                android:layout_width=&quot;wrap_content&quot;
                android:layout_height=&quot;wrap_content&quot;
                android:layout_toRightOf=&quot;@id/tv_name&quot;
                android:layout_marginLeft=&quot;10dp&quot;/&gt;
    &lt;/RelativeLayout&gt;
&lt;/layout&gt;
</code></pre><p>data中申明了变量user，type属性指定了user对应的Java类com.jimmy.demo.databinding.simple.model.User。User是一个普通的Java实体类：</p>
<pre><code>public class User {

    public String name;
    public int age;

    public User(String name, int age) {
        this.name = name;
        this.age = age;
    }

}
</code></pre><p>申明了user变量，在后面的布局中就可以用@{}语法表达式的方式使用user属性，如上面布局文件中TextView属性android:text=”@{user.name}”，由于user.age是int类型，所以使用的时候需要转换成String类型，String是常用类在布局文件中不需要import就能直接使用。</p>
<p>这里就可以看到数据绑定的特点，布局文件中属性值绑定之后是可以动态变化的，而不需要通过在代码中找到对应View逐一修改。</p>
<h2 id="Binding-Data"><a href="#Binding-Data" class="headerlink" title="Binding Data"></a>Binding Data</h2><p>完成data-binding布局文件，会默认生成对应的class(例如上面的main_activity.xml会生成MainActivityBinding.class)也可以在布局文件data节点中添加class属性指定Binding class名字。</p>
<pre><code>&lt;data class=&quot;com.jimmy.demo.MyBinding&quot;&gt;
    ....
&lt;/data&gt;
</code></pre><p>在Activity或者Fragment中用DataBindingUtil设置布局，返回Binding class对象，这里是MainActivityBinding对象，然后绑定User实体数据。</p>
<pre><code>@Override
protected void onCreate(Bundle savedInstanceState) {
    super.onCreate(savedInstanceState);
    binding = DataBindingUtil.setContentView(this, R.layout.activity_main);
    user = new User(&quot;Amanada&quot;, 25);
    binding.setUser(user);
}
</code></pre><p>至此，一个简单的Android数据绑定demo就完成了，运行demo可以看到两个TextView的值分别为Amanda和25。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/02/11/偶遇/" itemprop="url">
                  偶遇
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-02-11T15:36:33+08:00" content="2015-02-11">
              2015-02-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/杂谈/" itemprop="url" rel="index">
                    <span itemprop="name">杂谈</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/02/11/偶遇/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/02/11/偶遇/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <blockquote>
<p>佛说：前世五百次的回眸才能换来今生的一次擦身而过，那么要多少次的回眸，才换得人海茫茫中的相遇、相知、相爱。</p>
</blockquote>
<p>2015年1月17日 下午3点 北京西单 我遇上了她——阿漫 ！！！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/11/12/SmartWatch-2应用开发环境搭建/" itemprop="url">
                  SmartWatch 2应用开发环境搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-11-12T19:56:22+08:00" content="2014-11-12">
              2014-11-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Watch/" itemprop="url" rel="index">
                    <span itemprop="name">Watch</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/11/12/SmartWatch-2应用开发环境搭建/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/11/12/SmartWatch-2应用开发环境搭建/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="开发环境搭建"><a href="#开发环境搭建" class="headerlink" title="开发环境搭建"></a>开发环境搭建</h1><h2 id="Android开发环境"><a href="#Android开发环境" class="headerlink" title="Android开发环境"></a>Android开发环境</h2><p>smartWatch 2系统是基于Android基础定制的，SmartWatch 2应用开发需要Android应用开发的相关环境：Java、Android sdk、eclipse/android-studio。</p>
<h2 id="SmartWatch开发环境"><a href="#SmartWatch开发环境" class="headerlink" title="SmartWatch开发环境"></a>SmartWatch开发环境</h2><p>开发SmartWatch 2应用另外需要sony提供的Sony-Add-on-SDK。</p>
<p>Sony-Add-on-SDK提供Javadoc、code example、smartWatch模拟器、Smart Extension API和debug应用。Sony-Add-on-SDK有两种安装方式：</p>
<p><strong>在线安装</strong></p>
<ol>
<li>Eclipse中启动Android SDK Manager</li>
<li>打开Tools &gt; Manage Add-on Sites …</li>
<li>点击User Defined Sites页签，New，输入 <a href="http://dl-developer.sonymobile.com/sdk_manager/Sony-Add-on-SDK.xml点击OK，然后点击close" target="_blank" rel="external">http://dl-developer.sonymobile.com/sdk_manager/Sony-Add-on-SDK.xml点击OK，然后点击close</a></li>
<li>点开Android4.4.2(API 19) Packages，选中Sony Add-on SDK，然后点击Install packages。</li>
</ol>
<p>参考：<a href="https://developer.sony.com/develop/wearables/smartwatch-2-apis/get-started" target="_blank" rel="external">https://developer.sony.com/develop/wearables/smartwatch-2-apis/get-started</a></p>
<p><strong>手动安装</strong></p>
<ol>
<li>从sony官网上下载Sony Add-on SDK，下载地址：<a href="http://developer.sonymobile.com/downloads/sdks/sony-add-on-sdk-manual-installation-kit" target="_blank" rel="external">http://developer.sonymobile.com/downloads/sdks/sony-add-on-sdk-manual-installation-kit</a></li>
<li>拷贝Sony-Add-on-SDK中的addon-sony_add-on_sdk_3_0-sony-19文件夹到ADT Bundle文件夹下面的Android SDK里add-ons文件夹里</li>
</ol>
<p>Sony Add-on SDK目录结构如下：<br><img src="/images/watch-add-on-sdk.jpg" alt=""></p>
<ul>
<li>apks文件夹下是手机上的SmartWatch模拟器应用</li>
<li>docs是api文档文件</li>
<li>images/libs是sony手机模拟器相关镜像</li>
<li>samples是官方提供的实例源码，包括SmartExtensionAPI和SmartExtensionUtils两个库工程，SmartWatch其它应用必须得引用SmartExtensionAPI和SmartExtensionUtils</li>
</ul>
<h1 id="配置开发环境"><a href="#配置开发环境" class="headerlink" title="配置开发环境"></a>配置开发环境</h1><p>以add-ons\addon-sony_add-on_sdk_3_0-sony-19\samples\SmartExtensions下的HelloLayouts项目为例：</p>
<ol>
<li>启动Eclipse , 然后File &gt; Import ，再导入页面选择 Android -&gt; Existing Android Code Into Workspace，点击下一步</li>
<li>Browse… 选择add-ons\addon-sony_add-on_sdk_3_0-sony-19\samples\SmartExtensions</li>
<li>选中 HelloLayouts,  SmartExtensionAPI, SmartExtensionUtils, 然后点击完成</li>
<li>在HelloLayouts项目中右键 -&gt; Properties -&gt; Android，右边Project Build Target 选择Sony Add-on SDK</li>
<li>在Android右边Library ，Add Library 依次选择SmartExtensionAPI, SmartExtensionUtils，然后点击Apply -&gt; OK</li>
<li>分别clean HelloLayouts,  SmartExtensionAPI, SmartExtensionUtils，项目应该就没有错误了</li>
</ol>
<h1 id="运行"><a href="#运行" class="headerlink" title="运行"></a>运行</h1><p>Android环境和SmartWatch环境配置完成了，现在还不能运行HelloLayouts，因为还没有配置运行环境。手机端需要安装三个app:</p>
<p><strong>SmartWatch 2 SW2</strong>，介绍和下载地址如下：<br><a href="https://play.google.com/store/apps/details?id=com.sonymobile.smartconnect.smartwatch2" target="_blank" rel="external">Google play下载</a><br><a href="http://www.appchina.com/app/com.sonymobile.smartconnect.smartwatch2/" target="_blank" rel="external">应用汇下载</a></p>
<p><strong>Smart Connect</strong>，介绍和下载地址如下：<br><a href="https://play.google.com/store/apps/details?id=com.sonyericsson.extras.liveware" target="_blank" rel="external">Google play下载</a><br><a href="https://play.google.com/store/apps/details?id=com.sonyericsson.extras.liveware" target="_blank" rel="external">酷安下载</a></p>
<p><strong>Emulator on Phone</strong> 手机上的模拟器<br>位于/android-sdk/add-ons/addon-sony_add-on_sdk_3_0-sony-19/apks/accessory_emulator.apk</p>
<p>安装完上面三个应用后，进行运行</p>
<ol>
<li>eclipse上运行配置好的HelloLayout，因为没有启动的Activity不能看到界面；</li>
<li>打开手机上的配件模拟器（accessory_emulator.apk），选择模拟配置SmartWatch 2；</li>
<li>点击控件API，将在屏幕中间显示手表模拟器；</li>
<li>点击“点按可选择扩展程序”，选择HelloLayouts，模拟器中将显示对应界面。</li>
</ol>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="keshuangjie" />
          <p class="site-author-name" itemprop="name">keshuangjie</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">22</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">6</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">28</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">keshuangjie</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"keshuangjie"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
  






  
  
  

  

  

</body>
</html>
